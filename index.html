<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mewa - Stock Recommendations</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-card: #ffffff;
            --reco-bg: #dbdbdb;
            --text-primary: #1a1a1a;
            --text-secondary: #6c757d;
            --accent-buy: #10b981;
            /* --accent-sell: #ef4444; */
            --accent-sell: #f87171;
            --accent-primary: #3b82f6;
            --border-color: #e5e7eb;
            --shadow: rgba(0, 0, 0, 0.05);
            --revised-badge: #f59e0b;
            --stamp-highlight: rgba(0, 0, 0, 0.08);
            --stamp-bg: rgba(0, 0, 0, 0.02);
        }

        [data-theme="dark"] {
            /* --bg-primary: #0a0a0a; */
            --bg-primary: #292828;
            --bg-secondary: #141414;
            --bg-card: #1a1a1a;
            --reco-bg: #1a1a1a;
            --text-primary: #ffffff;
            --text-secondary: #9ca3af;
            --border-color: #2a2a2a;
            --shadow: rgba(0, 0, 0, 0.3);
            --stamp-highlight: rgba(255, 255, 255, 0.08);
            --stamp-bg: rgba(255, 255, 255, 0.03);
        }
        
        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            transition: background 0.2s ease, color 0.2s ease;
            padding-bottom: 80px;
        }

        /* Clean header without animations */
        .app-header {
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
            padding: 0.25rem 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        /* Updated header to be responsive with hamburger at start, logo center, mode at end */
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .hamburger-btn {
            order: 1;
        }

        .app-title {
            order: 2;
        }

        .theme-toggle {
            order: 3;
        }

        @media (min-width: 768px) {
            .header-content {
                justify-content: space-between;
            }

            .hamburger-btn {
                order: 1;
            }

            .app-title {
                order: 2;

            }

            .theme-toggle {
                order: 3;
            }
        }

        .theme-toggle {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 40px;
            height: 40px;
        }

        .theme-toggle:hover {
            background: var(--border-color);
        }

        .theme-toggle i {
            font-size: 1.1rem;
            color: var(--text-primary);
        }

        /* Clean professional card design */
        .reco-card {
            /* background: var(--bg-card); */
            background: var(--reco-bg);
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px var(--shadow);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        /* Gradient border on all four corners with consistent color order */
        .reco-card::before {
            content: '';
            position: absolute;
            inset: 0;
            padding: 3px;
            background: linear-gradient(135deg, #f59e0b, #ec4899, #8b5cf6, #3b82f6);
            border-radius: 12px;
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            pointer-events: none;
            opacity: 1;
        }

        .reco-card:hover {
            box-shadow: 0 4px 12px var(--shadow);
        }

        /* Updated profit card with bold gradient and shimmer animation */
        .reco-card.profit {
            background: linear-gradient(135deg, 
                rgba(16, 185, 129, 0.15) 0%, 
                rgba(52, 211, 153, 0.08) 50%,
                var(--bg-card) 100%);
            border: 2px solid var(--accent-buy);
            box-shadow: 0 8px 32px rgba(16, 185, 129, 0.25);
            position: relative;
            overflow: hidden;
            padding-bottom: 0.60rem !important;
        }

        .reco-card.profit::before {
            opacity: 0;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .reco-card.profit::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent 30%,
                rgba(16, 185, 129, 0.1) 50%,
                transparent 70%
            );
            animation: shimmer 3s infinite;
            pointer-events: none;
        }

        /* Updated loss card with gradient and pulse animation */
        .reco-card.loss {
            background: linear-gradient(135deg, 
                rgba(239, 68, 68, 0.15) 0%, 
                rgba(248, 113, 113, 0.08) 50%,
                var(--bg-card) 100%);
            border: 2px solid var(--accent-sell);
            box-shadow: 0 8px 32px rgba(239, 68, 68, 0.25);
            position: relative;
            overflow: hidden;
            padding-bottom: 0.60rem !important;
        }

        .reco-card.loss::before {
            opacity: 0;
        }

        .reco-card.loss::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(
                circle,
                rgba(239, 68, 68, 0.08) 0%,
                transparent 70%
            );
            animation: pulse 2s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
        }

        /* Added stamp-style indicators for revised, profit, and loss */
        .status-stamp {
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            transform: translateY(-50%);
            text-align: center;
            padding: 2.3rem 0; 
            font-size: 1.25rem;
            font-weight: 900;
            letter-spacing: 2px;
            text-transform: uppercase;
            border-radius: 6px;
            opacity: 0.9;
            z-index: 10;
            pointer-events: auto;
            box-shadow: 0 2px 8px rgba(0,0,0,0.25);
            background-color: var(--stamp-bg);
            background:
                radial-gradient(circle at 0 0,
                    var(--stamp-highlight) 0,
                    rgba(0,0,0,0) 70%
                ),
                repeating-linear-gradient(
                    45deg,
                    var(--stamp-highlight) 0px,
                    var(--stamp-highlight) 6px,
                    transparent 6px,
                    transparent 12px
                );
            backdrop-filter: blur(1px);
            mask-image: radial-gradient(circle,
                rgba(0,0,0,1) 60%,
                rgba(0,0,0,0.6) 100%
            );
        }



        .status-stamp.revised-stamp {
            color: var(--accent-primary);
            /* border-color: var(--accent-primary);
            background: var(--bg-card); */
        }

        .status-stamp.profit-stamp {
            color: var(--accent-buy);
            /* border-color: var(--accent-buy);
            background: var(--bg-card); */
        }

        .status-stamp.loss-stamp {
            color: var(--accent-sell);
            /* border-color: var(--accent-sell);
            background: var(--bg-card); */
        }

        /* Updated profit/loss card backgrounds with light watermark effect */
        .reco-card.profit {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.05) 0%, var(--bg-card) 100%);
            /* border-left: 4px solid var(--accent-buy); */
        }

        .reco-card.profit::before {
            opacity: 0;
        }

        .reco-card.loss {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.05) 0%, var(--bg-card) 100%);
            /* border-left: 4px solid var(--accent-sell); */
        }

        .reco-card.loss::before {
            opacity: 0;
        }

        /* Added watermark effect for revised cards in active tab */
        .reco-card.revised-watermark .detail-value .strikethrough::after {
            content: 'REVISED';
            position: absolute;
            top: 50%;
            left: -40%;
            right: -40%;
            transform: translateY(-50%) rotate(-10deg);
            font-size: 1rem;
            font-weight: 900;
            color: var(--accent-primary);
            opacity: 0.25;
            letter-spacing: 4px;
            white-space: nowrap;
            pointer-events: none;
            text-align: center;
        }

        /* Status badges */
        .status-badges {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        /* Updated status badges with modern glassmorphic design */
        .status-badge {
            padding: 0.5rem 1rem;
            border-radius: 12px;
            font-weight: 700;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            backdrop-filter: blur(10px);
            border: 1.5px solid;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .status-badge.profit-badge {
            background: linear-gradient(135deg, 
                rgba(16, 185, 129, 0.9) 0%, 
                rgba(52, 211, 153, 0.8) 100%);
            color: white;
            border-color: rgba(255, 255, 255, 0.3);
            animation: celebratePulse 1.5s ease-in-out infinite;            
        }

        /* Added celebration animation for profit badge */
        @keyframes celebratePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status-badge.loss-badge {
            background: linear-gradient(135deg, 
                rgba(239, 68, 68, 0.9) 0%, 
                rgba(248, 113, 113, 0.8) 100%);
            color: white;
            border-color: rgba(255, 255, 255, 0.3);
            animation: celebratePulse 1.5s ease-in-out infinite;            

        }

        /* Card header */
        .card-header-custom {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
            gap: 0.75rem;
        }

        .script-info {
            flex: 1;
            min-width: 0;
        }

        .script-name-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .stock-name {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .live-price {
            display: inline-flex;
            align-items: center;
            /* background: var(--bg-secondary); */
            border-radius: 6px;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--accent-buy);
        }

        /* Added Live tag with blinking red dot and light color label */
        .live-tag {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            background: rgba(239, 68, 68, 0.1);
            padding: 0.25rem 0.6rem;
            border-radius: 4px;
            font-size: 0.65rem;
            font-weight: 700;
            color: var(--accent-sell);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .live-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--accent-sell);
            animation: blink 1.5s infinite;
        }

        @keyframes blink {
            0%, 50%, 100% { opacity: 1; }
            25%, 75% { opacity: 0.3; }
        }

        .recommended-time {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.35rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
            font-size: 0.8rem;
        }

        .research-report {
            font-size: 0.75rem;
            margin-left: auto;
            color: var(--text-secondary);
        }

        /* Professional action badge without animations */
        .action-badge {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 700;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            flex-shrink: 0;
            color: white;
            margin-top: 6px;
        }

        .action-badge.buy {
            background: var(--accent-buy);
        }

        .action-badge.sell {
            background: var(--accent-sell);
        }

        /* Emphasized buying zone with clean design */
        .buying-zone {
            background: rgba(59, 130, 246, 0.08);
            border: 2px solid var(--accent-primary);
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .buying-zone-label {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.4rem;
        }

        .buying-zone-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--accent-primary);
        }

        .buying-zone-label.profit {
            color: var(--accent-buy);
        }

        .buying-zone-value.profit {
            color: var(--accent-buy);
        }

        .buying-zone-label.loss {
            color: var(--accent-sell);
        }

        .buying-zone-value.loss {
            color: var(--accent-sell);
        }

        /* Card details */
        .card-detail {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: var(--bg-secondary);
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }

        .card-detail:last-of-type {
            margin-bottom: 0;
        }

        .detail-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-transform: uppercase;
        }

        .detail-value {
            font-size: 1rem;
            color: var(--text-primary);
            font-weight: 700;
            text-align: right;
        }

        .detail-value.small {
            font-size: 0.75rem;        
        }

        .strikethrough {
            text-decoration: line-through;
            color: var(--text-secondary);
            opacity: 0.6;
            margin-right: 0.5rem;
        }

        /* Clean arrow button */
        .view-revised-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            background: transparent;
            /* color: white; */
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
            transition: background 0.2s ease;
            margin-top: 1rem;
            width: 100%;
        }


        /* Revision History - same card design as recommendations */
        .revision-card {
            /* background: var(--bg-card); */
            background: var(--reco-bg);
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px var(--shadow);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        /* Updated gradient to match reco-card order */
        .revision-card::before {
            content: '';
            position: absolute;
            inset: 0;
            padding: 3px;
            background: linear-gradient(135deg, #f59e0b, #ec4899, #8b5cf6, #3b82f6);
            border-radius: 12px;
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            pointer-events: none;
            opacity: 1;
        }

        .revision-card:hover {
            box-shadow: 0 4px 12px var(--shadow);
        }

        /* Updated profit styling to match reco-card exactly */
        .revision-card.profit {
            background: linear-gradient(135deg, 
                rgba(16, 185, 129, 0.15) 0%, 
                rgba(52, 211, 153, 0.08) 50%,
                var(--bg-card) 100%);
            border: 2px solid var(--accent-buy);
            box-shadow: 0 8px 32px rgba(16, 185, 129, 0.25);
            position: relative;
            overflow: hidden;
            padding-bottom: 0.60rem !important;
        }

        .revision-card.profit::before {
            opacity: 0;
        }

        .revision-card.profit::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent 30%,
                rgba(16, 185, 129, 0.1) 50%,
                transparent 70%
            );
            animation: shimmer 3s infinite;
            pointer-events: none;
        }

        /* Updated loss styling to match reco-card exactly */
        .revision-card.loss {
            background: linear-gradient(135deg, 
                rgba(239, 68, 68, 0.15) 0%, 
                rgba(248, 113, 113, 0.08) 50%,
                var(--bg-card) 100%);
            border: 2px solid var(--accent-sell);
            box-shadow: 0 8px 32px rgba(239, 68, 68, 0.25);
            position: relative;
            overflow: hidden;
            padding-bottom: 0.60rem !important;
        }

        .revision-card.loss::before {
            opacity: 0;
        }

        .revision-card.loss::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(
                circle,
                rgba(239, 68, 68, 0.08) 0%,
                transparent 70%
            );
            animation: pulse 2s ease-in-out infinite;
            pointer-events: none;
        }

        .revision-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
            gap: 0.75rem;
        }

        .revision-header-left {
            flex: 1;
            min-width: 0;
        }

        .revision-script-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .revision-script-name {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .revision-live-price {
            display: inline-flex;
            align-items: center;
            /* background: var(--bg-secondary); */
            border-radius: 6px;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--accent-buy);
        }

        .revision-time {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.35rem;
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        /* Revision timestamp styling */
        .revision-timestamp {
            font-size: 0.7rem;
            color: var(--text-secondary);
            margin-top: 0; /* CHANGE: Remove top margin so timestamp stays inline */
        }

        .revision-buying-info {
            background: rgba(59, 130, 246, 0.08);
            border: 2px solid var(--accent-primary);
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .revision-buying-label {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.4rem;
        }

        .revision-buying-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--accent-primary);
        }

        /* Updated revision item styling to match card details */
        /* .revision-current-prices {
            margin-bottom: 1rem;
        } */

        .revision-price-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: var(--bg-secondary);
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }

        .revision-price-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-transform: uppercase;
        }

        .revision-price-value {
            font-size: 1rem;
            color: var(--text-primary);
            font-weight: 700;
            text-align: right;
        }

        /* Styling for strikethrough with light tone in history */
        .revision-row-value .old-price {
            text-decoration: line-through;
            color: var(--text-secondary);
            opacity: 0.5;
            margin-right: 0.5rem;
            font-size: 0.85rem;
        }

        .revised-text {
            display: block;
            font-size: 0.75rem;
            color: var(--accent-primary);
            font-weight: 700;
            margin-top: 0.25rem;
        }

        /* History toggle button */
        .history-toggle-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            padding: 0.75rem;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
            margin-top: 1rem;
        }

        .history-toggle-btn:hover {
            background: var(--border-color);
        }

        .history-toggle-btn i {
            transition: transform 0.3s ease;
        }

        /* .history-toggle-btn.expanded i {
            transform: rotate(180deg);
        } */

        /* Collapsible history section */
        .revision-history-section {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .revision-history-section.expanded {
            max-height: 100%;
        }

        /* Simplified timeline without excessive decorations */
        .revision-timeline {
            position: relative;
            padding-left: 1.5rem;
            margin-top: 1rem;
        }

        .revision-timeline::before {
            content: '';
            position: absolute;
            left: 0.4rem;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--border-color);
        }

        .revision-item {
            position: relative;
            margin-bottom: 1.25rem;
        }

        .revision-item::before {
            content: '';
            position: absolute;
            left: -1.15rem;
            top: 0.35rem;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--accent-primary);
            border: 2px solid var(--bg-card);
        }

        /* CHANGE: Update layout to flex for inline date/time */
        .revision-label {
            font-size: 0.85rem;
            color: var(--accent-primary);
            font-weight: 700;
            text-transform: uppercase;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .revision-details {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .revision-row {
            display: flex;
            justify-content: space-between;
            padding: 0.6rem;
            background: var(--bg-secondary);
            border-radius: 6px;
        }

        .revision-row-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
        }

        .revision-row-value {
            font-size: 0.95rem;
            color: var(--text-primary);
            font-weight: 700;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        /* Tab Content */
        .tab-content-custom {
            display: none;
        }

        .tab-content-custom.active {
            display: block;
        }
        
        /* Adding missing tab buttons styling that was lost */
        .custom-tabs {
            position: sticky;
            top: 3.15rem;
            z-index: 99;
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 0.25rem;
            margin-bottom: 1rem;
        }

        .tab-buttons {
            display: flex;
            gap: 0.5rem;
            /* max-width: 1200px; */
            /* margin: 0 auto; */
        }

        .tab-btn {
            flex: 1;
            padding: 0.75rem 1.5rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-bottom: none;
            border-radius: 8px 8px 0 0;
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .tab-btn:hover {
            background: var(--bg-card);
            color: var(--text-primary);
        }

        .tab-btn.active {
            /* background: var(--bg-primary); */
            color: var(--accent-primary);
            border-color: var(--border-color);
            border-bottom: 2px solid var(--accent-primary);
        }

        /* Adding greeting section styling */
        .greeting-section {
            /* max-width: 1200px; */
            /* margin: 0 auto; */
            padding: 1.5rem 1rem 0;
        }

        .greeting-text {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .greeting-subtext {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin: 0;
        }

        /* Adding bottom navigation bar styles */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-card);
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-around;
            align-items: center;
            /* padding: 0.75rem 1rem; */
            z-index: 100;
            box-shadow: 0 -2px 10px var(--shadow);
        }

        .bottom-nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            padding: 0.5rem;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 8px;
        }

        .bottom-nav-item i {
            font-size: 1.25rem;
        }

        .bottom-nav-item.active {
            color: var(--accent-primary);
            background: rgba(59, 130, 246, 0.1);
        }

        .bottom-nav-item:hover {
            color: var(--accent-primary);
        }

        /* Adding download icon styling */
        .download-icon {
            margin-left: 0.5rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: color 0.2s ease;
            margin-top: 6px;
        }

        .download-icon:hover {
            color: var(--accent-primary);
        }

        /* Added hamburger menu and sidebar styles */
        .hamburger-btn {
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hamburger-btn i {
            font-size: 1.5rem;
            color: var(--text-primary);
        }

        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 998;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .sidebar-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .sidebar-menu {
            position: fixed;
            top: 0;
            left: -300px;
            width: 280px;
            height: 100%;
            background: var(--bg-card);
            border-right: 1px solid var(--border-color);
            z-index: 999;
            transition: left 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .sidebar-menu.active {
            left: 0;
        }

        .sidebar-header {
            padding: 1.5rem 1rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .sidebar-close {
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
        }

        .sidebar-close i {
            font-size: 1.5rem;
            color: var(--text-primary);
        }

        .sidebar-content {
            flex: 1;
            padding: 1rem 0;
            overflow-y: auto;
        }

        .sidebar-nav-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            color: var(--text-primary);
            text-decoration: none;
            transition: all 0.2s ease;
            cursor: pointer;
            background: transparent;
            border: none;
            width: 100%;
            text-align: left;
            font-size: 1rem;
        }

        .sidebar-nav-item:hover {
            background: var(--bg-secondary);
        }

        .sidebar-nav-item i {
            font-size: 1.25rem;
        }

        .sidebar-footer {
            padding: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .theme-switch {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.5rem;
            color: var(--text-primary);
        }

        .theme-switch-label {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 1rem;
        }

        .theme-switch-label i {
            font-size: 1.25rem;
        }

        .theme-toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            background: var(--bg-secondary);
            border-radius: 13px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .theme-toggle-switch::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background: var(--text-primary);
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        [data-theme="light"] .theme-toggle-switch {
            background: var(--accent-primary);
        }
        [data-theme="light"] .theme-toggle-switch::after {
            transform: translateX(24px);
            background: var(--bg-card);
        }

        /* Added horizontal rule between cards for better separation */
        .card-separator {
            border: none;
            height: 2px;
            background: var(--border-color);
            margin: 1.5rem auto;
            opacity: 1;
            width: 80%;
        }

        /* Responsive */
        @media (min-width: 768px) {
            .cards-container {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(450px, 1fr));
                gap: 1.5rem;
            }

            .reco-card, .revision-card {
                margin-bottom: 0;
            }

            .card-separator {
                display: none;
            }
        }

        @media (min-width: 1200px) {
            .cards-container {
                grid-template-columns: repeat(auto-fill, minmax(500px, 1fr));
            }
        }

        /* Added collapsible details section for completed recommendations */
        .collapsible-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .collapsible-details.expanded {
            max-height: 100%;
            transition: max-height 0.5s ease-in;
        }

        .show-more-btn {
            color: var(--accent-primary); /* Changed to accent-primary */
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9rem;
            margin-top: 0.75rem;
            padding: 0.5rem;
            transition: all 0.3s ease;
        }

        .show-more-btn:hover {
            color: var(--text-primary); /* Changed to text-primary for better contrast */
            transform: translateX(4px);
        }

        .show-more-btn i {
            transition: transform 0.3s ease;
        }

        .show-more-btn.expanded i {
            transform: rotate(180deg);
        }

        /* Added rotating border effect for completed recommendations */
        .completed-card {
            position: relative;
            overflow: hidden;
        }

        .completed-card::before {
            content: '';
            position: absolute;
            inset: 0;
            padding: 3px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-primary)); /* Placeholder, adjust gradient as needed */
            border-radius: 12px;
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            pointer-events: none;
            z-index: 1;
            opacity: 0.5;
        }

        .profit-complete::before {
            background: linear-gradient(135deg, var(--accent-buy), var(--accent-buy));
        }

        .loss-complete::before {
            background: linear-gradient(135deg, var(--accent-sell), var(--accent-sell));
        }

        .completed-card:hover {
            box-shadow: 0 4px 12px var(--shadow);
        }

        /* Floating status for completed recommendations */
        .floating-status {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 700;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: white;
            z-index: 2;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .profit-status {
            background: linear-gradient(135deg, var(--accent-buy), rgba(16, 185, 129, 0.7));
        }

        .loss-status {
            background: linear-gradient(135deg, var(--accent-sell), rgba(239, 68, 68, 0.7));
        }

        .floating-status i {
            font-size: 1rem;
        }

        /* CHANGE: Adding styles for completion box and collapsible content */
        .completion-box {
            background: var(--bg-card);
            border: 2px solid var(--accent-buy);
            border-radius: 10px;
            padding: 0.75rem 1rem;
            margin-bottom: 0.75rem;
            font-weight: 600;
            /* text-align: center; */
            color: var(--accent-buy);
        }

        .completion-box.loss-box {
            border-color: var(--accent-sell);
            color: var(--accent-sell);
        }

        /* .show-more-btn {
            color: var(--accent-primary);
            font-weight: 500;
            cursor: pointer;
            padding: 0.5rem 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        .show-more-btn:hover {
            color: var(--accent-secondary);
        } */

        /* .collapsible-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .collapsible-details.expanded {
            max-height: 2000px;
        } */

    </style>
</head>
<body data-theme="dark">
    <header class="app-header">
        <!-- <div class="header-content">
            <button class="hamburger-btn" id="hamburgerToggle">
                <i class="bi bi-list"></i>
            </button>
            <h1 class="app-title">Mewa</h1>
            <button class="theme-toggle" id="themeToggle">
                <i class="bi bi-moon-stars-fill" id="themeIcon"></i>
            </button>
        </div> -->
        <div class="row p-0 m-0 align-items-center">
            <div class="col p-0 m-0">
                <button class="hamburger-btn" id="hamburgerToggle">
                    <i class="bi bi-list"></i>
                </button>
            </div>

            <div class="col p-0 m-0 text-center text-nowrap">
                <!-- Added logo image before The Mewa text -->
                <h1 class="app-title" style="font-size: calc(1.375rem + 0.5vw); margin-bottom: 0px;">
                    <img src="mewa_logo.png" 
                         alt="Mewa Logo" 
                         style="height: 21px; width: auto; vertical-align: middle;">
                    The Mewa
                </h1>
            </div>

            <div class="col p-0 m-0 text-end">
                <button class="theme-toggle" id="themeToggle">
                    <i class="bi bi-moon-stars-fill" id="themeIcon"></i>
                </button>
            </div>
        </div>

    </header>

    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    <div class="sidebar-menu" id="sidebarMenu">
        <div class="sidebar-header">
            <h2 class="sidebar-title">Menu</h2>
            <button class="sidebar-close" id="sidebarClose">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>
        <div class="sidebar-content">
            <a href="#" class="sidebar-nav-item">
                <i class="bi bi-house-fill"></i>
                Home
            </a>
            <a href="#" class="sidebar-nav-item">
                <i class="bi bi-bar-chart-fill"></i>
                Charts
            </a>
            <a href="#" class="sidebar-nav-item">
                <i class="bi bi-download"></i>
                Download
            </a>
        </div>
        <div class="sidebar-footer">
            <div class="theme-switch" id="themeSwitch">
                <div class="theme-switch-label">
                    <i class="bi bi-moon-fill" id="sidebarThemeIcon"></i>
                    Light Mode
                </div>
                <div class="theme-toggle-switch" id="sidebarThemeToggle"></div>
            </div>
        </div>
    </div>

    <!-- Added greeting section styles -->
    <!-- <div class="greeting-section">
        <h2 class="greeting-text">Good Morning!</h2>
        <p class="greeting-subtext">Here are your latest stock recommendations.</p>
    </div> -->

    <div class="custom-tabs">
        <p class="text-end p-0 m-0 mb-1" onclick="window.location = 'past-performance.html'">Past Performance <i class="bi bi-arrow-right"></i> &nbsp;&nbsp;</p>
        <div class="tab-buttons">
            <button class="tab-btn active" data-tab="active">Active Recommendations</button>
            <button class="tab-btn" data-tab="revisions">Revised Recommendations</button>
        </div>
    </div>

    <div class="tab-content-custom active" id="activeTab">
        <div class="cards-container px-1" id="activeRecommendations"></div>
    </div>

    <div class="tab-content-custom" id="revisionsTab">
        <div class="cards-container px-1" id="revisionHistory"></div>
    </div>

    <!-- Adding bottom navigation bar -->
    <div class="bottom-nav">
        <button class="bottom-nav-item active" data-category="cash">
            <i class="bi bi-cash-coin"></i>
            <span>Cash</span>
        </button>
        <button class="bottom-nav-item" data-category="options">
            <i class="bi bi-graph-up"></i>
            <span>Options</span>
        </button>
        <button class="bottom-nav-item" data-category="future">
            <i class="bi bi-bar-chart-line"></i>
            <span>Future</span>
        </button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // setInterval(simulatePriceMovement, 1000); //animate the stock price
        const recommendations = [
            {
                id: 1,
                script: "RELIANCE",
                action: "buy",
                buyingPrice: "₹2,450 - ₹2,500",
                stopLoss: "₹2,350",
                targetPrice: "₹2,800",
                livePrice: "₹2,820",
                recommendedAt: "10:30:45 AM - Jan 15, 2024", // Added seconds
                recommendedAtTime: "10:30:45 AM",
                recommendedAtDate: "Jan 15, 2024",
                status: "profit",
                profitAmount: "₹320",
                isRevised: true,
                previousStopLoss: "₹2,400",
                previousTarget: "₹2,700",
                category: "cash",
                exitPrice: "₹2820", // Added for completed status
                exitDate: "Jan 17, 2024", // Added for completed status
                duration: "2 days", // Added for completed status
                profitPercentage: "12.8%", // Added for completed status
                revisions: [
                    { version: "Original", stopLoss: "₹2,400", target: "₹2,700", timestamp: "10:30:45 AM - Jan 15, 2024", changedField: "both" }, // Added timestamps to revisions
                    { version: "1st Revision", stopLoss: "₹2,350", target: "₹2,750", timestamp: "02:15:30 PM - Jan 15, 2024", changedField: "both" },
                    { version: "2nd Revision", stopLoss: "₹2,350", target: "₹2,800", timestamp: "04:45:12 PM - Jan 15, 2024", changedField: "target" }
                ]
            },
            {
                id: 2,
                script: "TCS",
                action: "buy",
                buyingPrice: "₹3,600 - ₹3,650",
                stopLoss: "₹3,500",
                targetPrice: "₹3,900",
                livePrice: "₹3,680",
                recommendedAt: "02:15:22 PM - Jan 14, 2024", // Added seconds
                recommendedAtTime: "02:15:22 PM",
                recommendedAtDate: "Jan 14, 2024",
                status: "active",
                isRevised: false,
                category: "cash",
                revisions: [
                    { version: "Original", stopLoss: "₹3,500", target: "₹3,900", timestamp: "02:15:22 PM - Jan 14, 2024", changedField: "both" }
                ]
            },
            {
                id: 3,
                script: "INFY",
                action: "sell",
                buyingPrice: "₹1,480 - ₹1,500",
                stopLoss: "₹1,550",
                targetPrice: "₹1,350",
                livePrice: "₹1,560",
                recommendedAt: "11:45:08 AM - Jan 13, 2024", // Added seconds
                recommendedAtTime: "11:45:08 AM",
                recommendedAtDate: "Jan 13, 2024",
                status: "loss",
                lossAmount: "₹60", // Assuming lossAmount is available for display
                isRevised: true,
                previousStopLoss: "₹1,580",
                previousTarget: "₹1,400",
                category: "cash",
                exitPrice: "1560", // Added for completed status
                exitDate: "Jan 15, 2024", // Added for completed status
                duration: "2 days", // Added for completed status
                profitPercentage: "-4%", // Added for completed status
                revisions: [
                    { version: "Original", stopLoss: "₹1,580", target: "₹1,400", timestamp: "11:45:08 AM - Jan 13, 2024", changedField: "both" },
                    { version: "1st Revision", stopLoss: "₹1,550", target: "₹1,350", timestamp: "03:20:15 PM - Jan 13, 2024", changedField: "both" }
                ]
            },
            {
                id: 4,
                script: "HDFC BANK",
                action: "buy",
                buyingPrice: "₹1,650 - ₹1,680",
                stopLoss: "₹1,600",
                targetPrice: "₹1,800",
                livePrice: "₹1,720",
                recommendedAt: "09:00:33 AM - Jan 16, 2024", // Added seconds
                recommendedAtTime: "09:00:33 AM",
                recommendedAtDate: "Jan 16, 2024",
                status: "active",
                isRevised: false,
                category: "cash",
                revisions: [
                    { version: "Original", stopLoss: "₹1,600", target: "₹1,800", timestamp: "09:00:33 AM - Jan 16, 2024", changedField: "both" }
                ]
            },
            {
                id: 5,
                script: "WIPRO",
                action: "sell",
                buyingPrice: "₹420 - ₹430",
                stopLoss: "₹450",
                targetPrice: "₹380",
                livePrice: "₹415",
                recommendedAt: "03:30:50 PM - Jan 12, 2024", // Added seconds
                recommendedAtTime: "03:30:50 PM",
                recommendedAtDate: "Jan 12, 2024",
                status: "active",
                isRevised: true,
                previousStopLoss: "₹460",
                previousTarget: "₹390",
                category: "cash",
                revisions: [
                    { version: "Original", stopLoss: "₹460", target: "₹390", timestamp: "03:30:50 PM - Jan 12, 2024", changedField: "both" },
                    { version: "1st Revision", stopLoss: "₹455", target: "₹385", timestamp: "10:15:25 AM - Jan 13, 2024", changedField: "both" },
                    { version: "2nd Revision", stopLoss: "₹450", target: "₹382", timestamp: "01:45:40 PM - Jan 13, 2024", changedField: "both" },
                    { version: "3rd Revision", stopLoss: "₹450", target: "₹380", timestamp: "04:30:18 PM - Jan 13, 2024", changedField: "target" }
                ]
            },
            {
                id: 6,
                script: "NIFTY 18500 CE",
                action: "buy",
                buyingPrice: "₹120 - ₹125",
                stopLoss: "₹100",
                targetPrice: "₹180",
                livePrice: "₹145",
                recommendedAt: "09:30:12 AM - Jan 17, 2024", // Added seconds
                recommendedAtTime: "09:30:12 AM",
                recommendedAtDate: "Jan 17, 2024",
                status: "active",
                isRevised: false,
                category: "options",
                revisions: [
                    { version: "Original", stopLoss: "₹100", target: "₹180", timestamp: "09:30:12 AM - Jan 17, 2024", changedField: "both" }
                ]
            },
            {
                id: 7,
                script: "BANKNIFTY 42000 PE",
                action: "sell",
                buyingPrice: "₹200 - ₹210",
                stopLoss: "₹240",
                targetPrice: "₹150",
                livePrice: "₹190",
                recommendedAt: "11:00:55 AM - Jan 16, 2024", // Added seconds
                recommendedAtTime: "11:00:55 AM",
                recommendedAtDate: "Jan 16, 2024",
                status: "active",
                isRevised: true,
                previousStopLoss: "₹250",
                previousTarget: "₹160",
                category: "options",
                revisions: [
                    { version: "Original", stopLoss: "₹250", target: "₹160", timestamp: "11:00:55 AM - Jan 16, 2024", changedField: "both" },
                    { version: "1st Revision", stopLoss: "₹240", target: "₹150", timestamp: "02:30:20 PM - Jan 16, 2024", changedField: "both" }
                ]
            },
            {
                id: 8,
                script: "NIFTY FEB FUT",
                action: "buy",
                buyingPrice: "₹18,400 - ₹18,450",
                stopLoss: "₹18,250",
                targetPrice: "₹18,750",
                livePrice: "₹18,520",
                recommendedAt: "10:00:28 AM - Jan 15, 2024", // Added seconds
                recommendedAtTime: "10:00:28 AM",
                recommendedAtDate: "Jan 15, 2024",
                status: "active",
                isRevised: false,
                category: "future",
                revisions: [
                    { version: "Original", stopLoss: "₹18,250", target: "₹18,750", timestamp: "10:00:28 AM - Jan 15, 2024", changedField: "both" }
                ]
            },
            {
                id: 9,
                script: "BANKNIFTY FEB FUT",
                action: "sell",
                buyingPrice: "₹42,100 - ₹42,200",
                stopLoss: "₹42,500",
                targetPrice: "₹41,500",
                livePrice: "₹41,800",
                recommendedAt: "01:00:37 PM - Jan 14, 2024", // Added seconds
                recommendedAtTime: "01:00:37 PM",
                recommendedAtDate: "Jan 14, 2024",
                status: "active",
                isRevised: true,
                previousStopLoss: "₹42,600",
                previousTarget: "₹41,600",
                category: "future",
                revisions: [
                    { version: "Original", stopLoss: "₹42,600", target: "₹41,600", timestamp: "01:00:37 PM - Jan 14, 2024", changedField: "both" },
                    { version: "1st Revision", stopLoss: "₹42,500", target: "₹41,500", timestamp: "03:45:52 PM - Jan 14, 2024", changedField: "both" }
                ]
            },
            {
                id: 10,
                script: "TATASTEEL",
                action: "buy",
                buyingPrice: "₹130 - ₹133",
                stopLoss: "₹125",
                targetPrice: "₹145",
                livePrice: "₹135",
                recommendedAt: "02:30:44 PM - Jan 17, 2024", // Added seconds
                recommendedAtTime: "02:30:44 PM",
                recommendedAtDate: "Jan 17, 2024",
                status: "active",
                isRevised: false,
                category: "cash",
                revisions: [
                    { version: "Original", stopLoss: "₹125", target: "₹145", timestamp: "02:30:44 PM - Jan 17, 2024", changedField: "both" }
                ]
            }
        ];

        const expandedHistories = new Set();
        const sidebarMenu = document.getElementById('sidebarMenu');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        const sidebarClose = document.getElementById('sidebarClose');
        const hamburgerToggle = document.getElementById('hamburgerToggle');
        const themeToggleSwitch = document.getElementById('themeToggleSwitch');
        const body = document.body;
        let currentCategory = 'cash'; // Default category

        function getFilteredRecommendations() {
            return recommendations.filter(reco => reco.category === currentCategory);
        }

        function simulatePriceMovement() {
            recommendations.forEach(reco => {
                const currentPrice = parseFloat(reco.livePrice.replace(/[₹,]/g, ''));
                const volatility = 0.002; // 0.2% movement
                const change = currentPrice * volatility * (Math.random() > 0.5 ? 1 : -1);
                const newPrice = currentPrice + change;
                reco.livePrice = `₹${newPrice.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}`;
                
                const activePriceElement = document.getElementById(`active_price_${reco.id}`);
                if (activePriceElement) {
                    activePriceElement.textContent = reco.livePrice;
                }
                
                const revisedPriceElement = document.getElementById(`revised_price_${reco.id}`);
                if (revisedPriceElement) {
                    revisedPriceElement.textContent = reco.livePrice;
                }
            });
        }

        function toggleDetails(recoId, type) {
            const detailsSection = document.getElementById(`${type}_details_${recoId}`);
            const button = event.currentTarget;
            
            if (detailsSection.classList.contains('expanded')) {
                detailsSection.classList.remove('expanded');
                button.innerHTML = 'Show More <i class="bi bi-chevron-down"></i>';
            } else {
                detailsSection.classList.add('expanded');
                button.innerHTML = 'Show Less <i class="bi bi-chevron-up"></i>';
            }
        }

        function renderRecommendationCard(reco) {
            const container = document.getElementById('activeRecommendations');
            const card = document.createElement('div');
            
            // if (reco.status === 'profit' || reco.status === 'loss') {
            //     card.classList.add('completed-card');
            //     if (reco.status === 'profit') {
            //         card.classList.add('profit-complete');
            //     } else {
            //         card.classList.add('loss-complete');
            //     }
            // }

            card.className = `reco-card ${reco.status}`; // Added status class for styling
            card.id = `active_reco_${reco.id}`;

            if (reco.status === 'profit') {
                card.classList.add('profit');
            } else if (reco.status === 'loss') {
                card.classList.add('loss');
            }


            let stampHTML = '';
            if (reco.isRevised) {
                stampHTML = '<div class="status-stamp revised-stamp" onclick="viewRevisedTab()" style="cursor: pointer;">REVISED</div>';
            }

            // let statusBadgesHTML = '';
            // if (reco.status === 'profit') {
            //     statusBadgesHTML += `<div class="status-badge profit-badge">Target Hit • ${reco.profitAmount}</div>`;
            // }
            // if (reco.status === 'loss') {
            //     statusBadgesHTML += `<div class="status-badge loss-badge">Stop Loss Hit • ${reco.lossAmount}</div>`;
            // }

            const isCompleted = reco.status === 'profit' || reco.status === 'loss';

            // ${statusBadgesHTML ? `<div class="status-badges">${statusBadgesHTML}</div>` : ''}
            card.innerHTML = `
                ${isCompleted ? `
                    <div class="card-header-custom">
                        <div class="script-info">
                            <div class="script-name-row">
                                <span class="stock-name">${reco.script}</span>
                            </div>                            
                        </div>
                        <div class="action-badge ${reco.action}">${reco.action.toUpperCase()}</div>
                    </div>
                    <div class="completion-box ${reco.status === 'loss' ? 'loss-box' : ''}">                        
                        <div class="buying-zone-label ${reco.status}">${reco.status === 'profit' ? `Target Hit` : `Stop Loss Hit`}</div>
                        <div class="buying-zone-value ${reco.status}">${reco.status === 'profit' ? `Profit per lot - ${reco.profitAmount}` : `Loss per lot - ${reco.lossAmount}`}</div>                    
                    </div>                    
                    <p class="show-more-btn mb-0 text-center" onclick="toggleDetails(${reco.id}, 'active')">
                        Show More <i class="bi bi-chevron-down"></i>
                    </p>
                    <div class="collapsible-details" id="active_details_${reco.id}">                        
                        <div class="card-body-custom">
                            <div class="card-detail">
                                <span class="detail-label">
                                    <i class="bi bi-wallet"></i>
                                    Buying Zone
                                </span>
                                <span class="detail-value">${reco.buyingPrice}</span>
                            </div>
                            <div class="card-detail">
                                <span class="detail-label">
                                    <i class="bi bi-currency-rupee"></i>
                                    Exit Price
                                </span>
                                <span class="detail-value">${reco.exitPrice}</span>
                            </div>
                            <div class="card-detail">
                                <span class="detail-label">
                                    <i class="bi bi-cash-stack"></i>
                                    ${reco.status === 'profit' ? 'Profit' : 'Loss'} per Lot
                                </span>
                                <span class="detail-value">${reco.status === 'profit' ? reco.profitAmount : reco.lossAmount} <small class="detail-value small">(${reco.profitPercentage || '10%'})</small></span>
                            </div>                            
                            <div class="card-detail">
                                <span class="detail-label">
                                    <i class="bi bi-calendar-check"></i>
                                    Recommended On
                                </span>
                                <span class="detail-value">${reco.recommendedAtDate}</span>
                            </div>
                            <div class="card-detail">
                                <span class="detail-label">
                                    <i class="bi bi-calendar-check"></i>
                                    Exit Date
                                </span>
                                <span class="detail-value">${reco.exitDate || reco.recommendedAt}</span>
                            </div>
                            <div class="card-detail">
                                <span class="detail-label">
                                    <i class="bi bi-hourglass-split"></i>
                                    Duration
                                </span>
                                <span class="detail-value">${reco.duration || '5 days'}</span>
                            </div>
                            <div class="card-detail">
                                <span class="detail-label">
                                    <span class="research-report mt-2">Research report </span><i class="bi bi-download download-icon"></i>
                                </span>
                                <span class="detail-value">
                                    <div class="d-flex align-items-center">
                                        <span class="pe-2">${reco.profitPercentage || '10%'}</span>
                                        <i class="bi bi-${reco.status === 'profit' ? 'arrow-up-circle-fill text-success' : 'arrow-down-circle-fill text-danger'}" style="font-size: 1.5rem;"></i>
                                    </div>
                                </span>
                            </div>
                        </div>
                    </div>
                ` : `
                    <div class="card-header-custom">
                        <div class="script-info">
                            <div class="script-name-row">
                                <span class="stock-name">${reco.script}</span>
                            </div>
                            <div class="script-name-row">
                                <span class="live-price" id="active_price_${reco.id}">${reco.livePrice}</span>
                                <span class="live-tag">
                                    <span class="live-dot"></span>
                                    Live
                                </span>
                            </div>
                        </div>
                        <div class="action-badge ${reco.action}">${reco.action.toUpperCase()}</div>
                    </div>
                    <div class="buying-zone">
                        <div class="buying-zone-label">${reco.action === 'buy' ? 'Buying' : 'Selling'} Zone</div>
                        <div class="buying-zone-value">${reco.buyingPrice}</div>
                    </div>

                    <div class="card-body-custom" style="position: relative;">
                        ${stampHTML}
                        <div class="card-detail">
                            <span class="detail-label">
                                <i class="bi bi-bullseye"></i>
                                Target
                            </span>
                            <span class="detail-value">
                                ${reco.isRevised && reco.previousTarget ? `<span class="strikethrough">${reco.previousTarget}</span>` : `${reco.targetPrice}`}                                
                            </span>
                        </div>
                        <div class="card-detail">
                            <span class="detail-label">
                                <i class="bi bi-shield-x"></i>
                                Stop Loss
                            </span>
                            <span class="detail-value">
                                ${reco.isRevised && reco.previousStopLoss ? `<span class="strikethrough">${reco.previousStopLoss}</span>` : `${reco.stopLoss}`}                  
                            </span>
                        </div>
                    </div>
                    <div class="card-detail bg-transparent">
                        <div class="recommended-time">
                            <span>
                                <i class="bi bi-clock"></i>
                                ${reco.recommendedAt}
                            </span>
                        </div>
                        <span class="research-report mt-2">Research report </span><i class="bi bi-download download-icon"></i>
                    </div>
                    
                    ${reco.isRevised ? `
                        <p class="view-revised-btn mb-0" onclick="viewRevisedTab()">
                            View Revised Recommendation
                            <i class="bi bi-arrow-right"></i>
                        </p>
                    ` : ''}
                `}
            `;

            container.appendChild(card);
            
            if (reco !== getFilteredRecommendations()[getFilteredRecommendations().length - 1]) {
                const separator = document.createElement('hr');
                separator.className = 'card-separator';
                container.appendChild(separator);
            }
        }

        function renderActiveRecommendations() {
            const container = document.getElementById('activeRecommendations');
            container.innerHTML = '';

            const filteredRecos = getFilteredRecommendations();

            if (filteredRecos.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-inbox"></i>
                        <p>No active recommendations</p>
                    </div>
                `;
                return;
            }

            filteredRecos.forEach(reco => {
                renderRecommendationCard(reco);
            });
        }

        function renderRevisionHistory() {
            const container = document.getElementById('revisionHistory'); // Corrected ID
            container.innerHTML = '';
            
            // Filter recommendations based on current category and if they are revised
            const filteredRecos = getFilteredRecommendations().filter(reco => reco.isRevised);

            if (filteredRecos.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-inbox"></i>
                        <p>No revised recommendations</p>
                    </div>
                `;
                return;
            }

            filteredRecos.forEach(reco => {
                const card = document.createElement('div');
                card.className = `revision-card ${reco.status}`; // Added status class for styling
                card.id = `revised_reco_${reco.id}`;

                if (reco.status === 'profit') {
                    card.classList.add('profit');
                } else if (reco.status === 'loss') {
                    card.classList.add('loss');
                }

                // const latestRevision = reco.revisions[reco.revisions.length - 1];
                // const hasMultipleRevisions = reco.revisions.length > 1;

                let stampHTML = '';
                if (reco.isRevised) {
                    // stampHTML = '<div class="status-stamp revised-stamp">REVISED</div>'; // Removed as it's redundant if card is in revisions tab
                }

                // let statusBadgesHTML = '';
                // if (reco.status === 'profit') {
                //     statusBadgesHTML += `<div class="status-badge profit-badge">Target Hit • ${reco.profitAmount}</div>`;
                // }
                // if (reco.status === 'loss') {
                //     statusBadgesHTML += `<div class="status-badge loss-badge">Stop Loss Hit • ${reco.lossAmount}</div>`;
                // }

                const latestRevision = reco.revisions[reco.revisions.length - 1];
                const originalRevision = reco.revisions[0];
                const isCompleted = reco.status === 'profit' || reco.status === 'loss';

                let previousTargetPrice = null;
                let targetRevisionNumber = 0;
                for (let i = reco.revisions.length - 2; i >= 0; i--) {
                    if (reco.revisions[i].target !== latestRevision.target) {
                        previousTargetPrice = reco.revisions[i].target;
                        // Count how many times target has been revised (current revision index)
                        let revisionCount = 0;
                        for (let j = 1; j <= reco.revisions.length - 1; j++) {
                            if (reco.revisions[j].target !== reco.revisions[j-1].target) {
                                revisionCount++;
                            }
                        }
                        targetRevisionNumber = revisionCount;
                        break;
                    }
                }
                
                let previousStopLossPrice = null;
                let stopLossRevisionNumber = 0;
                for (let i = reco.revisions.length - 2; i >= 0; i--) {
                    if (reco.revisions[i].stopLoss !== latestRevision.stopLoss) {
                        previousStopLossPrice = reco.revisions[i].stopLoss;
                        // Count how many times stop loss has been revised (current revision index)
                        let revisionCount = 0;
                        for (let j = 1; j <= reco.revisions.length - 1; j++) {
                            if (reco.revisions[j].stopLoss !== reco.revisions[j-1].stopLoss) {
                                revisionCount++;
                            }
                        }
                        stopLossRevisionNumber = revisionCount;
                        break;
                    }
                }

                const hasMultipleRevisions = reco.revisions.length > 1;

                let revisionsHTML = '';
                reco.revisions.forEach((rev, index) => {
                    const prevRev = index > 0 ? reco.revisions[index - 1] : null;
                    const isLast = index === reco.revisions.length - 1;
                    const changedField = rev.changedField || 'both';
                    
                    const isLatestTarget = rev.target === latestRevision.target;
                    const isLatestStopLoss = rev.stopLoss === latestRevision.stopLoss;
                    
                        revisionsHTML += `
                            <div class="revision-item">
                            <div class="revision-label">
                                <span>${rev.version} <i class="bi bi-download mx-2"></i></span>
                                <span class="revision-timestamp">
                                        <i class="bi bi-clock"></i>
                                        ${rev.timestamp}
                                    </span>
                                </div>
                            <div class="revision-details">`;

                    // Only show target if it was changed or if it's the original
                    if (changedField === 'both' || changedField === 'target' || index === 0) {
                            revisionsHTML += `
                            <div class="revision-row">
                                <span class="revision-row-label">Target</span>
                                <span class="revision-row-value">
                                    ${prevRev ? `<span class="strikethrough" style="font-size: 0.8rem; opacity: 0.5; text-decoration: line-through; margin-right: 0.5rem;">${prevRev.target}</span>` : ''}
                                    ${isLatestTarget ? rev.target : `<span style="text-decoration: line-through; opacity: 0.6;">${rev.target}</span>`}
                                </span>
                            </div>`;
                        }

                    if (changedField === 'both' || changedField === 'stopLoss' || index === 0) {
                            revisionsHTML += `
                            <div class="revision-row">
                                <span class="revision-row-label">Stop Loss</span>
                                <span class="revision-row-value">
                                    ${prevRev ? `<span class="strikethrough" style="font-size: 0.8rem; opacity: 0.5; text-decoration: line-through; margin-right: 0.5rem;">${prevRev.stopLoss}</span>` : ''}
                                    ${isLatestStopLoss ? rev.stopLoss : `<span style="text-decoration: line-through; opacity: 0.6;">${rev.stopLoss}</span>`}
                                </span>
                            </div>`;
                        }

                        revisionsHTML += `
                                </div>
                            </div>
                        `;
                });

                // ${statusBadgesHTML ? `<div class="status-badges">${statusBadgesHTML}</div>` : ''}
                card.innerHTML = `                    
                    ${isCompleted ? `
                        <div class="revision-header">
                            <div class="revision-header-left">
                                <div class="revision-script-row">
                                    <span class="revision-script-name">${reco.script}</span>
                                </div>                                
                            </div>
                            <div class="action-badge ${reco.action}">${reco.action.toUpperCase()}</div>
                        </div>
                        <div class="completion-box ${reco.status === 'loss' ? 'loss-box' : ''}">                            
                            <div class="buying-zone-label ${reco.status}">${reco.status === 'profit' ? `Target Hit` : `Stop Loss Hit`}</div>                            
                            <div class="buying-zone-value ${reco.status}">${reco.status === 'profit' ? `Profit per lot - ${reco.profitAmount}` : `Loss per lot - ${reco.lossAmount}`}</div>                    
                        </div>                        
                        <p class="show-more-btn mb-0 text-center" onclick="toggleDetails(${reco.id}, 'revised')">
                            Show More <i class="bi bi-chevron-down"></i>
                        </p>
                        <div class="collapsible-details" id="revised_details_${reco.id}">                            
                            <div class="card-body-custom">
                                <div class="card-detail">
                                    <span class="detail-label">
                                        <i class="bi bi-wallet"></i>
                                        Buying Zone
                                    </span>
                                    <span class="detail-value">${reco.buyingPrice}</span>
                                </div>
                                <div class="card-detail">
                                    <span class="detail-label">
                                        <i class="bi bi-currency-rupee"></i>
                                        Exit Price
                                    </span>
                                    <span class="detail-value">${reco.exitPrice}</span>
                                </div>
                                <div class="card-detail">
                                    <span class="detail-label">
                                        <i class="bi bi-cash-stack"></i>
                                        ${reco.status === 'profit' ? 'Profit' : 'Loss'} per Lot
                                    </span>
                                    <span class="detail-value">${reco.status === 'profit' ? reco.profitAmount : reco.lossAmount} <small class="detail-value small">(${reco.profitPercentage || '10%'})</small></span>
                                </div>             
                                <div class="card-detail">
                                    <span class="detail-label">
                                        <i class="bi bi-calendar-check"></i>
                                        Recommended On
                                    </span>
                                    <span class="detail-value">${reco.recommendedAtDate}</span>
                                </div>
                                <div class="card-detail">
                                    <span class="detail-label">
                                        <i class="bi bi-calendar-check"></i>
                                        Exit Date
                                    </span>
                                    <span class="detail-value">${reco.exitDate || reco.recommendedAt}</span>
                                </div>                                                   
                                <div class="card-detail">
                                    <span class="detail-label">
                                        <i class="bi bi-hourglass-split"></i>
                                        Duration
                                    </span>
                                    <span class="detail-value">${reco.duration || '5 days'}</span>
                                </div>
                                <div class="card-detail">
                                    <span class="detail-label">
                                        <span class="research-report mt-2">Research report </span><i class="bi bi-download download-icon"></i>
                                    </span>
                                    <span class="detail-value">
                                        <div class="d-flex align-items-center">
                                            <span class="pe-2">${reco.profitPercentage || '10%'}</span>
                                            <i class="bi bi-${reco.status === 'profit' ? 'arrow-up-circle-fill text-success' : 'arrow-down-circle-fill text-danger'}" style="font-size: 1.5rem;"></i>
                                        </div>
                                    </span>
                                </div>
                            </div>
                            ${hasMultipleRevisions ? `
                                <button class="history-toggle-btn" id="history-btn-${reco.id}" onclick="toggleHistory(${reco.id})">
                                    <i class="bi bi-clock-history"></i>
                                    View Full History
                                    <i class="bi bi-chevron-down"></i>
                                </button>
                                <div class="revision-history-section" id="history-${reco.id}">
                                    <div class="revision-timeline">
                                        ${revisionsHTML}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    ` : `
                        <div class="revision-header">
                            <div class="revision-header-left">
                                <div class="revision-script-row">
                                    <span class="revision-script-name">${reco.script}</span>
                                </div>
                                <div class="revision-script-row">
                                    <span class="revision-live-price" id="revised_price_${reco.id}">${reco.livePrice}</span>
                                    <span class="live-tag">
                                        <span class="live-dot"></span>
                                        Live
                                    </span>
                                </div>
                            </div>
                            <div class="action-badge ${reco.action}">${reco.action.toUpperCase()}</div>
                        </div>
                        <div class="revision-buying-info">                            
                            <div class="revision-buying-label">${reco.action === 'buy' ? 'Buying' : 'Selling'} Zone</div>
                            <div class="revision-buying-value">${reco.buyingPrice}</div>
                        </div>

                        <div class="revision-current-prices" style="position: relative;">
                            ${stampHTML}
                            <div class="revision-price-row">
                                <span class="revision-price-label">
                                    <i class="bi bi-bullseye"></i>
                                    Target
                                </span>
                                <div class="revision-price-value">
                                    ${previousTargetPrice ? `<span class="strikethrough" style="text-decoration: line-through; opacity: 0.6; margin-right: 0.5rem;">${previousTargetPrice}</span>` : ''}
                                    ${latestRevision.target}
                                    ${previousTargetPrice && targetRevisionNumber > 0 ? `<span class="revised-text">${targetRevisionNumber}${getOrdinalSuffix(targetRevisionNumber)} Revised Target</span>` : ''}
                                </div>
                            </div>
                            <div class="revision-price-row">
                                <span class="revision-price-label">
                                    <i class="bi bi-shield-x"></i>
                                    Stop Loss
                                </span>
                                <div class="revision-price-value">
                                    ${previousStopLossPrice ? `<span class="strikethrough" style="text-decoration: line-through; opacity: 0.6; margin-right: 0.5rem;">${previousStopLossPrice}</span>` : ''}
                                    ${latestRevision.stopLoss}
                                    ${previousStopLossPrice && stopLossRevisionNumber > 0 ? `<span class="revised-text">${stopLossRevisionNumber}${getOrdinalSuffix(stopLossRevisionNumber)} Revised Stop Loss</span>` : ''}
                                </div>
                            </div>
                        </div>
                        <div class="card-detail bg-transparent">
                            <div class="recommended-time">
                                <span>
                                    <i class="bi bi-clock"></i>
                                    ${reco.recommendedAt}
                                </span>
                            </div>
                            <span class="research-report mt-2">Research report </span><i class="bi bi-download download-icon"></i>
                        </div>
                        ${hasMultipleRevisions ? `
                            <button class="history-toggle-btn" id="history-btn-${reco.id}" onclick="toggleHistory(${reco.id})">
                                <i class="bi bi-clock-history"></i>
                                View Full History
                                <i class="bi bi-chevron-down"></i>
                            </button>
                            <div class="revision-history-section" id="history-${reco.id}">
                                <div class="revision-timeline">
                                    ${revisionsHTML}
                                </div>
                            </div>
                        ` : ''}
                    `}
                `;

                container.appendChild(card);
                
                if (reco !== filteredRecos[filteredRecos.length - 1]) {
                    const separator = document.createElement('hr');
                    separator.className = 'card-separator';
                    container.appendChild(separator);
                }
            });
        }

        function getOrdinalSuffix(num) {
            const suffixes = ['th', 'st', 'nd', 'rd'];
            const v = num % 100;
            return suffixes[(v - 20) % 10] || suffixes[v] || suffixes[0];
        }

        function toggleHistory(recoId) {
            const historySection = document.getElementById(`history-${recoId}`);
            const button = document.getElementById(`history-btn-${recoId}`);
            
            if (historySection.classList.contains('expanded')) {
                expandedHistories.delete(recoId);
                historySection.classList.remove('expanded');
                button.classList.remove('expanded');
                button.innerHTML = `
                    <i class="bi bi-clock-history"></i>
                    View Full History
                    <i class="bi bi-chevron-down"></i>
                `;
            } else {
                expandedHistories.add(recoId);
                historySection.classList.add('expanded');
                button.classList.add('expanded');
                button.innerHTML = `
                    <i class="bi bi-clock-history"></i>
                    Hide History
                    <i class="bi bi-chevron-up"></i>
                `;
            }
        }

        function viewRevisedTab() {
            const revisionsBtn = document.querySelector('[data-tab="revisions"]');
            revisionsBtn.click();
        }

        // Tab Switching
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content-custom');

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetTab = button.getAttribute('data-tab');
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));
                button.classList.add('active');

                if (targetTab === 'active') {
                    document.getElementById('activeTab').classList.add('active');
                } else if (targetTab === 'revisions') {
                    document.getElementById('revisionsTab').classList.add('active');
                }
            });
        });

        // Theme Toggle
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = document.getElementById('themeIcon');
        const themeSwitch = document.getElementById('themeSwitch');
        const sidebarThemeIcon = document.getElementById('sidebarThemeIcon');

        themeToggle.addEventListener('click', () => {
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            body.setAttribute('data-theme', newTheme);
            
            if (newTheme === 'dark') {
                themeIcon.className = 'bi bi-moon-stars-fill';
                sidebarThemeIcon.className = 'bi bi-moon-fill';
                // themeToggleSwitch.style.transform = 'translateX(0)'; // Handled by CSS variables
            } else {
                themeIcon.className = 'bi bi-sun-fill';
                sidebarThemeIcon.className = 'bi bi-sun-fill';
                // themeToggleSwitch.style.transform = 'translateX(24px)'; // Handled by CSS variables
            }
            localStorage.setItem('theme', newTheme);
        });

        // Load saved theme
        const savedTheme = localStorage.getItem('theme') || 'dark';
        body.setAttribute('data-theme', savedTheme);
        if (savedTheme === 'light') {
            themeIcon.className = 'bi bi-sun-fill';
            sidebarThemeIcon.className = 'bi bi-sun-fill';
        } else {
            themeIcon.className = 'bi bi-moon-stars-fill';
            sidebarThemeIcon.className = 'bi bi-moon-fill';
        }

        // Sidebar Toggle
        hamburgerToggle.addEventListener('click', () => {
            sidebarMenu.classList.add('active');
            sidebarOverlay.classList.add('active');
        });

        sidebarClose.addEventListener('click', () => {
            sidebarMenu.classList.remove('active');
            sidebarOverlay.classList.remove('active');
        });

        sidebarOverlay.addEventListener('click', () => {
            sidebarMenu.classList.remove('active');
            sidebarOverlay.classList.remove('active');
        });

        // Theme toggle in sidebar
        const sidebarThemeToggle = document.getElementById('sidebarThemeToggle');
        sidebarThemeToggle.addEventListener('click', () => {
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            body.setAttribute('data-theme', newTheme);
            
            if (newTheme === 'dark') {
                themeIcon.className = 'bi bi-moon-stars-fill';
                sidebarThemeIcon.className = 'bi bi-moon-fill';
                // themeToggleSwitch.style.transform = 'translateX(0)'; // Handled by CSS variables
            } else {
                themeIcon.className = 'bi bi-sun-fill';
                sidebarThemeIcon.className = 'bi bi-sun-fill';
                // themeToggleSwitch.style.transform = 'translateX(24px)'; // Handled by CSS variables
            }
            localStorage.setItem('theme', newTheme);
        });

        const bottomNavItems = document.querySelectorAll('.bottom-nav-item');
        bottomNavItems.forEach(item => {
            item.addEventListener('click', () => {
                const category = item.getAttribute('data-category');
                currentCategory = category;

                bottomNavItems.forEach(btn => btn.classList.remove('active'));
                item.classList.add('active');

                renderActiveRecommendations();
                renderRevisionHistory();
            });
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderActiveRecommendations();
            renderRevisionHistory();
            // Start simulating price movement only after initial render
            setInterval(simulatePriceMovement, 1000); 
        });
    </script>
</body>
</html>
